const fs = require('fs').promises;
const PNG = require('pngjs').PNG;
const pixelmatch = require('pixelmatch');

async function comparePNGs() {
    const json = await fs.readFile("../demos/static.json", 'utf8');
    let demos = JSON.parse(json);

    for (const d in demos) {
        if (demos[d].draft || d == "Isotype") continue;
        const data1 = await fs.readFile("demoScreenshots/"+d+".png");
        const data2 = await fs.readFile("png/"+d+".png");
        const img1 = PNG.sync.read(data1);
        const img2 = PNG.sync.read(data2);

        const { width, height } = img1;
        const diff = new PNG({ width, height });

        // Compare the images
        const numDiffPixels = pixelmatch(
            img1.data, img2.data, diff.data, width, height,
            { threshold: 0.1 }
        );

        if (numDiffPixels !== 0)
            console.log(d, "different");
    }
}

comparePNGs();